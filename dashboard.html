<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Tools4IT</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/dashboard.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Fixed Navbar -->
    <header class="navbar">
        <div class="container">
            <div class="logo">
                <h1><a href="index.html">Tools<span>4IT</span></a></h1>
            </div>
            <nav>
                <ul class="nav-links">
                    <li><a href="#" class="active" data-tab="dashboard">Dashboard</a></li>
                    <li><a href="#" data-tab="tasks">Tasks</a></li>
                    <li><a href="#" data-tab="timetables">Timetables</a></li>
                    <li><a href="#" data-tab="archive">Archive</a></li>
                </ul>
            </nav>
            <div class="user-menu">
                <div class="user-info">
                    <span>Welcome, <span id="current-user">User</span></span>
                </div>
                <div class="logout-btn">
                    <a href="#" id="logout-btn" class="btn btn-secondary">Logout</a>
                </div>
            </div>
        </div>
    </header>

    <!-- Dashboard Content -->
    <section class="dashboard-section">
        <div class="container">
            <div class="dashboard-header">
                <h1>Dashboard</h1>
                <p>Welcome to your Tools4IT dashboard</p>
            </div>
            
            <!-- Dashboard Overview Tab -->
            <div class="dashboard-tab active" id="dashboard-tab">
                <div class="dashboard-overview">
                    <div class="dashboard-card">
                        <div class="card-icon">
                            <i class="fas fa-tasks"></i>
                        </div>
                        <div class="card-content">
                            <h3>My Tasks</h3>
                            <p class="card-value" id="my-tasks-count">0</p>
                            <p>Active tasks assigned to you</p>
                        </div>
                    </div>
                    <div class="dashboard-card">
                        <div class="card-icon">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div class="card-content">
                            <h3>Completed</h3>
                            <p class="card-value" id="completed-tasks-count">0</p>
                            <p>Tasks completed by you</p>
                        </div>
                    </div>
                    <div class="dashboard-card">
                        <div class="card-icon">
                            <i class="fas fa-calendar-alt"></i>
                        </div>
                        <div class="card-content">
                            <h3>Availability</h3>
                            <p class="card-value" id="availability-status">Available</p>
                            <p>Your current status</p>
                        </div>
                    </div>
                    <div class="dashboard-card">
                        <div class="card-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="card-content">
                            <h3>Team</h3>
                            <p class="card-value">4</p>
                            <p>Team members</p>
                        </div>
                    </div>
                </div>
                
                <div class="dashboard-quick-actions">
                    <h2>Quick Actions</h2>
                    <div class="quick-actions-buttons">
                        <button class="btn btn-primary" id="new-task-btn"><i class="fas fa-plus"></i> New Task</button>
                        <button class="btn btn-secondary" id="update-status-btn"><i class="fas fa-sync-alt"></i> Update Status</button>
                        <button class="btn btn-secondary" id="view-timetable-btn"><i class="fas fa-calendar"></i> View Timetable</button>
                    </div>
                </div>
            </div>
            
            <!-- Tasks Tab (Post-it Section) -->
            <div class="dashboard-tab" id="tasks-tab">
                <div class="tasks-header">
                    <h2>Task Management</h2>
                    <button class="btn btn-primary" id="create-task-btn"><i class="fas fa-plus"></i> Create New Task</button>
                </div>
                
                <div class="task-form-container" id="task-form-container">
                    <form id="task-form">
                        <h3>Create New Task</h3>
                        <div class="form-group">
                            <label for="task-title">Task Title</label>
                            <input type="text" id="task-title" placeholder="Enter task title" required>
                        </div>
                        <div class="form-group">
                            <label for="task-school">School/Location</label>
                            <input type="text" id="task-school" placeholder="Enter school or location" required>
                        </div>
                        <div class="form-group">
                            <label for="task-description">What To Do</label>
                            <textarea id="task-description" placeholder="Describe what needs to be done" required></textarea>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="task-date">Date</label>
                                <input type="date" id="task-date" required>
                            </div>
                            <div class="form-group">
                                <label for="task-time">Time</label>
                                <input type="time" id="task-time" required>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="task-assignee">Assign To</label>
                            <select id="task-assignee" required>
                                <option value="">Select a team member</option>
                                <!-- Team members will be loaded dynamically -->
                            </select>
                        </div>
                        <div class="form-buttons">
                            <button type="submit" class="btn btn-primary">Create Task</button>
                            <button type="button" class="btn btn-secondary" id="cancel-task-btn">Cancel</button>
                        </div>
                    </form>
                </div>
                
                <div class="tasks-filter">
                    <div class="filter-group">
                        <label for="filter-status">Status:</label>
                        <select id="filter-status">
                            <option value="all">All</option>
                            <option value="pending">Pending</option>
                            <option value="completed">Completed</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="filter-assignee">Assignee:</label>
                        <select id="filter-assignee">
                            <option value="all">All</option>
                            <!-- Team members will be loaded dynamically -->
                        </select>
                    </div>
                </div>
                
                <div class="tasks-container" id="tasks-container">
                    <!-- Tasks will be dynamically added here -->
                    <div class="no-tasks-message">No tasks to display. Create a new task to get started.</div>
                </div>
                
                <!-- Task Completion Modal -->
                <div class="modal" id="complete-task-modal">
                    <div class="modal-content">
                        <span class="close-modal">&times;</span>
                        <h3>Complete Task</h3>
                        <form id="complete-task-form">
                            <input type="hidden" id="complete-task-id">
                            <div class="form-group">
                                <label for="completion-time">Time of Completion</label>
                                <input type="datetime-local" id="completion-time" required>
                            </div>
                            <div class="form-group">
                                <label for="solution-description">How was it solved?</label>
                                <textarea id="solution-description" placeholder="Describe how the task was solved" required></textarea>
                            </div>
                            <button type="submit" class="btn btn-primary">Mark as Completed</button>
                        </form>
                    </div>
                </div>
            </div>
            
            <!-- Timetables Tab -->
            <div class="dashboard-tab" id="timetables-tab">
                <h2>Employee Timetables</h2>
                <p>View the availability of team members throughout the day</p>
                
                <div class="timetable-controls">
                    <div class="date-selector">
                        <label for="timetable-date">Date:</label>
                        <input type="date" id="timetable-date">
                    </div>
                    <div class="legend">
                        <span class="legend-item"><span class="status-indicator available"></span> Available</span>
                        <span class="legend-item"><span class="status-indicator maybe"></span> Maybe Available</span>
                        <span class="legend-item"><span class="status-indicator busy"></span> Occupied</span>
                    </div>
                </div>
                
                <div class="timetable-container">
                    <div class="timetable-hours">
                        <div class="hour-label"></div>
                        <div class="hour-label">8:00</div>
                        <div class="hour-label">9:00</div>
                        <div class="hour-label">10:00</div>
                        <div class="hour-label">11:00</div>
                        <div class="hour-label">12:00</div>
                        <div class="hour-label">13:00</div>
                        <div class="hour-label">14:00</div>
                        <div class="hour-label">15:00</div>
                        <div class="hour-label">16:00</div>
                        <div class="hour-label">17:00</div>
                        <div class="hour-label">18:00</div>
                    </div>
                    
                    <div class="timetable" id="timetable-grid">
                        <!-- Timetable rows will be dynamically added here -->
                    </div>
                </div>
            </div>
            
            <!-- Archive Tab -->
            <div class="dashboard-tab" id="archive-tab">
                <h2>Task Archive</h2>
                <p>View completed tasks and their solutions</p>
                
                <div class="archive-filters">
                    <div class="filter-group">
                        <label for="archive-employee">Employee:</label>
                        <select id="archive-employee">
                            <option value="all">All Employees</option>
                            <!-- Team members will be loaded dynamically -->
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="archive-date-from">From:</label>
                        <input type="date" id="archive-date-from">
                    </div>
                    <div class="filter-group">
                        <label for="archive-date-to">To:</label>
                        <input type="date" id="archive-date-to">
                    </div>
                    <button class="btn btn-secondary" id="apply-archive-filters">Apply Filters</button>
                </div>
                
                <div class="archive-container" id="archive-container">
                    <!-- Archived tasks will be dynamically added here -->
                    <div class="no-tasks-message">No archived tasks to display.</div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-bottom">
                <p>&copy; 2025 Tools4IT. All Rights Reserved.</p>
            </div>
        </div>
    </footer>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>

    <!-- Your Firebase module -->
    <script src="js/firebase.js"></script>
    
    <!-- Standalone Tab Navigation -->
    <script>
        // Simple tab navigation that works independently
        window.addEventListener('load', function() {
            console.log("Window loaded - setting up standalone tab navigation");
            
            // Get all tab links and content
            const tabLinks = document.querySelectorAll('.nav-links a');
            const tabContents = document.querySelectorAll('.dashboard-tab');
            
            // Check if tasks container exists
            const tasksContainer = document.getElementById('tasks-container');
            console.log("Direct DOM check - tasks-container:", tasksContainer ? "Found" : "Not found");
            
            if (tasksContainer) {
                // Add a test task directly to verify DOM manipulation works
                const testTaskElement = document.createElement('div');
                testTaskElement.className = 'task-card direct-test';
                testTaskElement.innerHTML = `
                    <div class="task-header">
                        <h3>Direct Test Task</h3>
                        <span class="task-date">Test Date</span>
                    </div>
                    <div class="task-description">
                        <p>This is a direct test task added by the standalone script.</p>
                    </div>
                `;
                
                // Store original content
                const originalContent = tasksContainer.innerHTML;
                
                // Add test task
                tasksContainer.appendChild(testTaskElement);
                console.log("Direct test task added to container");
                
                // Restore original content after 3 seconds
                setTimeout(() => {
                    tasksContainer.innerHTML = originalContent;
                    console.log("Restored original content");
                }, 3000);
            }
            
            // Function to show a specific tab
            function showTab(tabId) {
                console.log("Showing tab:", tabId);
                
                // Hide all tabs
                tabContents.forEach(tab => {
                    tab.style.display = 'none';
                });
                
                // Remove active class from all links
                tabLinks.forEach(link => {
                    link.classList.remove('active');
                });
                
                // Show the selected tab
                const selectedTab = document.getElementById(tabId);
                if (selectedTab) {
                    selectedTab.style.display = 'block';
                    // Find and activate the corresponding link
                    const correspondingLink = document.querySelector(`.nav-links a[data-tab="${tabId.replace('-tab', '')}"]`);
                    if (correspondingLink) {
                        correspondingLink.classList.add('active');
                    }
                }
            }
            
            // Add click event to all tab links
            tabLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const tabId = this.getAttribute('data-tab') + '-tab';
                    showTab(tabId);
                });
            });
            
            // Show the default tab (dashboard)
            showTab('dashboard-tab');
        });
    </script>
    
    <!-- Ensure logout works -->
    <script>
        // Add direct event listener to logout button
        document.addEventListener('DOMContentLoaded', function() {
            console.log("DOM fully loaded");
            
            // Debug tab elements
            const allTabs = document.querySelectorAll('.dashboard-tab');
            console.log("Found dashboard tabs:", allTabs.length);
            allTabs.forEach((tab, index) => {
                console.log(`Tab ${index}:`, tab.id);
            });
            
            const allNavLinks = document.querySelectorAll('.nav-links a');
            console.log("Found nav links:", allNavLinks.length);
            allNavLinks.forEach((link, index) => {
                console.log(`Link ${index}:`, link.getAttribute('data-tab'));
            });
            
            const logoutBtn = document.getElementById('logout-btn');
            if (logoutBtn) {
                logoutBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    console.log("Logout button clicked");
                    
                    // Clear session storage
                    sessionStorage.removeItem('hasVisitedLoginPage');
                    localStorage.removeItem('currentUser');
                    
                    // Sign out from Firebase
                    firebase.auth().signOut()
                        .then(() => {
                            console.log("User signed out successfully");
                            // Redirect to login page
                            window.location.href = 'login.html';
                        })
                        .catch((error) => {
                            console.error("Error signing out:", error);
                            alert("Error signing out. Please try again.");
                        });
                });
            }
            
            // Direct tab navigation
            const navLinks = document.querySelectorAll('.nav-links a');
            const dashboardTabs = document.querySelectorAll('.dashboard-tab');
            
            console.log("Setting up direct tab navigation, found links:", navLinks.length);
            
            navLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const tabName = this.getAttribute('data-tab');
                    console.log("Tab clicked:", tabName);
                    
                    // Remove active class from all links and tabs
                    navLinks.forEach(l => l.classList.remove('active'));
                    dashboardTabs.forEach(t => t.classList.remove('active'));
                    
                    // Add active class to clicked link and corresponding tab
                    this.classList.add('active');
                    const targetTab = document.getElementById(`${tabName}-tab`);
                    if (targetTab) {
                        targetTab.classList.add('active');
                        console.log(`Activated tab: ${tabName}-tab`);
                    } else {
                        console.error(`Tab ${tabName}-tab not found`);
                    }
                });
            });
        });
    </script>
    
    <!-- Dashboard JavaScript -->
    <script src="js/dashboard.js"></script>
    
    <!-- Direct initialization script -->
    <script>
        // This script will run after all other scripts have loaded
        window.addEventListener('load', function() {
            console.log("Window fully loaded - running direct initialization");
            
            // Check if Firebase is initialized
            if (typeof firebase === 'undefined') {
                console.error("Firebase is not initialized!");
                alert("Error: Firebase is not initialized. Please refresh the page and try again.");
                return;
            }
            
            // Check if user is logged in
            const currentUser = firebase.auth().currentUser;
            console.log("Current user:", currentUser ? currentUser.uid : "No user signed in");
            
            if (!currentUser) {
                console.log("No user is signed in, checking local storage");
                const storedUser = localStorage.getItem('currentUser');
                if (!storedUser) {
                    console.log("No user found in local storage, redirecting to login");
                    window.location.href = 'login.html';
                    return;
                }
                console.log("User found in local storage:", JSON.parse(storedUser));
            }
            
            // Function to load tasks directly from Firebase
            function loadTasksDirectly() {
                console.log("Auto-loading tasks from Firebase");
                
                // Find tasks container
                const tasksContainer = document.getElementById('tasks-container');
                if (!tasksContainer) {
                    console.error("Tasks container not found");
                    return;
                }
                
                // Clear container
                tasksContainer.innerHTML = '';
                
                // Show loading message
                tasksContainer.innerHTML = '<div class="loading-message">Loading tasks from Firebase...</div>';
                
                // Get tasks directly from Firebase
                firebase.firestore().collection('tasks')
                    .where('status', '!=', 'completed') // Only get active tasks
                    .get()
                    .then(snapshot => {
                        console.log(`Retrieved ${snapshot.docs.length} active tasks from Firebase`);
                        
                        // Clear container
                        tasksContainer.innerHTML = '';
                        
                        if (snapshot.empty) {
                            tasksContainer.innerHTML = '<div class="no-tasks-message">No active tasks found in Firebase.</div>';
                            return;
                        }
                        
                        // Process and display tasks
                        snapshot.forEach(doc => {
                            const taskData = doc.data();
                            console.log(`Processing task ${doc.id}:`, taskData);
                            
                            // Create task element
                            const taskElement = document.createElement('div');
                            taskElement.className = 'task-card';
                            taskElement.dataset.id = doc.id;
                            
                            // Format date if available
                            let dateDisplay = 'No date';
                            if (taskData.date) {
                                try {
                                    const taskDate = new Date(taskData.date + 'T' + (taskData.time || '09:00'));
                                    dateDisplay = taskDate.toLocaleDateString() + ' ' + taskDate.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                                } catch (e) {
                                    console.error("Error formatting date:", e);
                                }
                            }
                            
                            // Check if this is from contact form
                            const isContactFormTask = taskData.source === 'contact_form';
                            const requesterInfo = isContactFormTask ? 
                                `<div class="task-requester">
                                    <i class="fas fa-user-circle"></i> Requested by: ${taskData.requesterName || 'Unknown'}
                                    <br><i class="fas fa-envelope"></i> ${taskData.requesterEmail || 'No email provided'}
                                </div>` : '';
                            
                            taskElement.innerHTML = `
                                <div class="task-header">
                                    <h3>${taskData.title || 'Untitled Task'}</h3>
                                    <span class="task-date">${dateDisplay}</span>
                                </div>
                                <div class="task-location">
                                    <i class="fas fa-map-marker-alt"></i> ${taskData.school || 'Unknown Location'}
                                </div>
                                <div class="task-description">
                                    <p>${taskData.description || 'No description provided'}</p>
                                </div>
                                ${requesterInfo}
                                <div class="task-footer">
                                    <div class="task-assignee">
                                        <i class="fas fa-user"></i> ${taskData.assignedTo ? 'Assigned' : 'Unassigned'}
                                    </div>
                                    <div class="task-actions">
                                        <button class="btn btn-sm btn-primary archive-task" data-id="${doc.id}">
                                            <i class="fas fa-archive"></i> Archive
                                        </button>
                                    </div>
                                </div>
                            `;
                            
                            // Add to container
                            tasksContainer.appendChild(taskElement);
                        });
                        
                        // Update the dashboard counts
                        const myTasksCount = document.getElementById('my-tasks-count');
                        if (myTasksCount) {
                            myTasksCount.textContent = snapshot.docs.length;
                        }
                        
                        // Also load archived tasks
                        loadArchivedTasks();
                    })
                    .catch(error => {
                        console.error("Error loading tasks:", error);
                        tasksContainer.innerHTML = `<div class="error-message">Error loading tasks: ${error.message}</div>`;
                    });
            }
            
            // Function to load archived tasks
            function loadArchivedTasks() {
                console.log("Loading archived tasks");
                
                // Find archive container
                const archiveContainer = document.getElementById('archive-container');
                if (!archiveContainer) {
                    console.error("Archive container not found");
                    return;
                }
                
                // Clear container
                archiveContainer.innerHTML = '';
                
                // Show loading message
                archiveContainer.innerHTML = '<div class="loading-message">Loading archived tasks...</div>';
                
                // Get archived tasks from Firebase
                firebase.firestore().collection('tasks')
                    .where('status', '==', 'completed')
                    .get()
                    .then(snapshot => {
                        console.log(`Retrieved ${snapshot.docs.length} archived tasks from Firebase`);
                        
                        // Clear container
                        archiveContainer.innerHTML = '';
                        
                        if (snapshot.empty) {
                            archiveContainer.innerHTML = '<div class="no-tasks-message">No archived tasks found.</div>';
                            return;
                        }
                        
                        // Process and display archived tasks
                        snapshot.forEach(doc => {
                            const taskData = doc.data();
                            console.log(`Processing archived task ${doc.id}:`, taskData);
                            
                            // Create archive item element
                            const archiveElement = document.createElement('div');
                            archiveElement.className = 'archive-item';
                            archiveElement.dataset.id = doc.id;
                            
                            // Format dates
                            let dateDisplay = 'No date';
                            if (taskData.date) {
                                try {
                                    const taskDate = new Date(taskData.date + 'T' + (taskData.time || '09:00'));
                                    dateDisplay = taskDate.toLocaleDateString();
                                } catch (e) {
                                    console.error("Error formatting date:", e);
                                }
                            }
                            
                            let completedDate = 'Unknown';
                            if (taskData.completedAt) {
                                try {
                                    const date = taskData.completedAt.toDate ? taskData.completedAt.toDate() : new Date(taskData.completedAt);
                                    completedDate = date.toLocaleDateString() + ' ' + date.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                                } catch (e) {
                                    console.error("Error formatting completed date:", e);
                                }
                            }
                            
                            // Check if this is from contact form
                            const isContactFormTask = taskData.source === 'contact_form';
                            const requesterInfo = isContactFormTask ? 
                                `<p><strong>Requested by:</strong> ${taskData.requesterName || 'Unknown'}</p>
                                <p><strong>Email:</strong> ${taskData.requesterEmail || 'No email provided'}</p>` : '';
                            
                            archiveElement.innerHTML = `
                                <div class="archive-header">
                                    <h3>${taskData.title || 'Untitled Task'}</h3>
                                    <span class="archive-date">Archived: ${completedDate}</span>
                                </div>
                                <div class="archive-details">
                                    <div class="archive-info">
                                        <p><strong>School/Location:</strong> ${taskData.school || 'Unknown Location'}</p>
                                        <p><strong>Scheduled:</strong> ${dateDisplay}</p>
                                        ${requesterInfo}
                                    </div>
                                    <div class="archive-description">
                                        <p><strong>Issue:</strong> ${taskData.description || 'No description provided'}</p>
                                        <p><strong>Solution:</strong> ${taskData.solution || 'No solution provided'}</p>
                                    </div>
                                </div>
                                <div class="archive-actions">
                                    <button class="btn btn-sm btn-danger delete-task" data-id="${doc.id}">
                                        <i class="fas fa-trash"></i> Delete
                                    </button>
                                </div>
                            `;
                            
                            // Add to container
                            archiveContainer.appendChild(archiveElement);
                        });
                        
                        // Update completed tasks count
                        const completedTasksCount = document.getElementById('completed-tasks-count');
                        if (completedTasksCount) {
                            completedTasksCount.textContent = snapshot.docs.length;
                        }
                    })
                    .catch(error => {
                        console.error("Error loading archived tasks:", error);
                        archiveContainer.innerHTML = `<div class="error-message">Error loading archived tasks: ${error.message}</div>`;
                    });
            }
            
            // Try multiple times with increasing delays to ensure tasks load
            // This helps with timing issues where Firebase might not be fully initialized
            setTimeout(loadTasksDirectly, 1000);  // Try after 1 second
            setTimeout(loadTasksDirectly, 3000);  // Try again after 3 seconds if needed
            
            // Add event listeners to archive task buttons
            document.addEventListener('click', function(e) {
                // Archive task button
                if (e.target.classList.contains('archive-task') || e.target.parentElement.classList.contains('archive-task')) {
                    const button = e.target.classList.contains('archive-task') ? e.target : e.target.parentElement;
                    const taskId = button.getAttribute('data-id');
                    console.log(`Archive task clicked for task ID: ${taskId}`);
                    
                    // Get task details from Firestore
                    firebase.firestore().collection('tasks').doc(taskId).get()
                        .then(doc => {
                            if (doc.exists) {
                                const taskData = doc.data();
                                
                                // Confirm archive
                                if (confirm(`Are you sure you want to archive this task?\n\nTitle: ${taskData.title}\nSchool: ${taskData.school}`)) {
                                    // Update task status to 'archived'
                                    return firebase.firestore().collection('tasks').doc(taskId).update({
                                        status: 'completed',
                                        completedAt: firebase.firestore.FieldValue.serverTimestamp(),
                                        completedBy: currentUser ? currentUser.uid : 'unknown',
                                        solution: 'Task archived by user'
                                    });
                                }
                            } else {
                                console.error("Task not found");
                                alert("Task not found");
                            }
                        })
                        .then(() => {
                            if (button.closest('.task-card')) {
                                // Remove the task card from the UI
                                button.closest('.task-card').remove();
                                
                                // Show success message
                                alert("Task archived successfully!");
                                
                                // Reload tasks to update the UI
                                setTimeout(loadTasksDirectly, 500);
                                
                                // Ask if user wants to view archived tasks
                                if (confirm("Task archived successfully! Would you like to view all archived tasks?")) {
                                    // Switch to archive tab
                                    const archiveLink = document.querySelector('.nav-links a[data-tab="archive"]');
                                    if (archiveLink) {
                                        archiveLink.click();
                                    }
                                }
                            }
                        })
                        .catch(error => {
                            console.error("Error archiving task:", error);
                            alert("Error archiving task: " + error.message);
                        });
                }
                
                // Delete task button
                if (e.target.classList.contains('delete-task') || e.target.parentElement.classList.contains('delete-task')) {
                    const button = e.target.classList.contains('delete-task') ? e.target : e.target.parentElement;
                    const taskId = button.getAttribute('data-id');
                    console.log(`Delete task clicked for task ID: ${taskId}`);
                    
                    // Confirm deletion
                    if (confirm("Are you sure you want to permanently delete this task? This action cannot be undone.")) {
                        // Delete task from Firestore
                        firebase.firestore().collection('tasks').doc(taskId).delete()
                            .then(() => {
                                console.log("Task deleted successfully");
                                
                                if (button.closest('.archive-item')) {
                                    // Remove the archive item from the UI
                                    button.closest('.archive-item').remove();
                                    
                                    // Show success message
                                    alert("Task deleted successfully!");
                                    
                                    // Update completed tasks count
                                    const completedTasksCount = document.getElementById('completed-tasks-count');
                                    if (completedTasksCount) {
                                        const currentCount = parseInt(completedTasksCount.textContent);
                                        completedTasksCount.textContent = Math.max(0, currentCount - 1);
                                    }
                                }
                            })
                            .catch(error => {
                                console.error("Error deleting task:", error);
                                alert("Error deleting task: " + error.message);
                            });
                    }
                }
            });
        });
    </script>
</body>
</html> 